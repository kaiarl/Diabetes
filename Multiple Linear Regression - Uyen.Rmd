---
title: "Multiple Linear Regression Runs"
author: "Uyen Nguyen"
output: 
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)

# Loading in tidyverse and dataset
library(tidyverse)
library(GGally)
diabetes <- as_tibble(read.csv('diabetes2.csv'))


# Change Outcome variable to factor with appropriate labels
diabetes$Outcome <- factor(diabetes$Outcome)
levels(diabetes$Outcome)
levels(diabetes$Outcome) <- c("No","Yes")
levels(diabetes$Outcome)

diabetes2 <- diabetes

zero_unknown_cols <-c("Glucose", "BloodPressure", "SkinThickness",
                      "Insulin", "BMI", "DiabetesPedigreeFunction",
                      "Age")



diabetes2[,zero_unknown_cols] <- replace(diabetes2[,zero_unknown_cols], diabetes2[,zero_unknown_cols]==0,NA)

diabetes2 <- dplyr::select(diabetes2, -c('SkinThickness', 'Insulin'))

fill_missing_cols <-c("Glucose", "BloodPressure", "BMI",
                      "DiabetesPedigreeFunction", "Age")

for(i in fill_missing_cols) {
  diabetes2[,i][is.na(diabetes2[,i])] <- median(diabetes2[,i][!is.na(diabetes2[,i])])
}
```

The data cleaning will ensure ggplot will color correctly for variable Outcome

```{r}
# Scatter plot using GGpairs
GGally::ggpairs(diabetes)
```

There were a lot of 0s in the plots and they might hurt the correlation so I removed them by Insulin then Glucose.

```{r}
# Filter out 0 values in Insulin and plot pairs
noNullIns <- diabetes %>% filter(Insulin != 0)
GGally::ggpairs(noNullIns)
```

Correlation and graphs look better after taking out 0s from Insulin!

```{r}
# Filter out 0 value in Glucose and plot pairs
noNullInsGlu <- noNullIns %>% filter(Glucose != 0)
GGally::ggpairs(noNullInsGlu)
```

Some correlations dropped after taking the 0 from Glucose, but graphs look better. 

```{r}
# Filter out 0 value in Glucose and plot pairs
noNullInsGluBMI <- noNullInsGlu %>% filter(BMI != 0)
GGally::ggpairs(noNullInsGluBMI)
```

I noticed some 0s in BMI so I removed them as well. 

```{r}
# Scatterplot of Glucose and Insulin with Outcome
ggplot(noNullInsGluBMI, aes(Glucose, Insulin, color = Outcome)) +
  geom_point()
```

The variance was non-constant so Idk.

# First run for MLR

```{r}
# Full model and summary
result <- lm(Glucose ~ Pregnancies + BloodPressure + SkinThickness + Insulin + BMI + DiabetesPedigreeFunction + Age, data=noNullInsGluBMI)
summary(result)
```

Pregnancies, skin thickness, BMI, and diabetes pedigree function didn't look significant based on p-values in the presence of the other predictors. Partial F test will be conducted to see if we can drop these variables. 

```{r}
# Checking for multicollinearity
faraway::vif(result)
```

Checking for multicollinearity signs in this model and it looks fine. Everything is definitely under 5 so we're in the clear. 

```{r}
reduced <- lm(Glucose ~ BloodPressure + Insulin + Age, data=noNullInsGluBMI)
summary(reduced)
```

Everything is significant in the reduced model so we'll run with this. 

```{r}
# Checking for multicollinearity
faraway::vif(reduced)
```

No signs of multicollinearity here either. 

```{r}
# Conducting partial F test
anova(reduced, result)
```

Insignificant p-value so we failed to reject the null and favor the reduced model. 


# Second run for MLR

